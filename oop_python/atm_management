"""
ATM System Simulator
====================
A simple command-line ATM system that allows users to:
- Create a secure PIN
- Deposit money
- Withdraw money
- Check account balance


"""


class ATM:
    """
    A class to simulate basic ATM operations.
    
    Attributes:
        pin (str): User's personal identification number
        balance (float): Current account balance
    """
    
    def __init__(self):
        """
        Initialize the ATM system with empty PIN and zero balance.
        Automatically starts the menu system.
        """
        self.pin = ""
        self.balance = 0
        print("=" * 50)
        print("Welcome to the ATM System".center(50))
        print("=" * 50)
        self.menu()
    
    def menu(self):
        """
        Display the main menu and handle user input.
        Routes user to appropriate methods based on selection.
        """
        user_input = input("""
How would you like to proceed?
Enter 1 to create pin
Enter 2 to deposit
Enter 3 to withdraw
Enter 4 to check balance
Enter 5 to exit
Your choice: """)
        
        # Route to appropriate method based on user input
        if user_input == "1":
            self.create_pin()
        elif user_input == "2":
            self.deposit()
        elif user_input == "3":
            self.withdraw()
        elif user_input == "4":
            self.check_balance()
        elif user_input == "5":
            self._exit_system()
        else:
            print("\n‚ùå Invalid option. Please try again.\n")
            self.menu()
    
    def create_pin(self):
        """
        Allow user to create a new PIN for their account.
        Overwrites existing PIN if one already exists.
        """
        print("\n--- Create PIN ---")
        self.pin = input("Create your PIN: ")
        print("‚úì PIN created successfully!\n")
        self.menu()
    
    def deposit(self):
        """
        Deposit money into the account after PIN verification.
        Validates that deposit amount is positive.
        """
        print("\n--- Deposit Money ---")
        
        # Verify PIN before allowing deposit
        if not self._verify_pin():
            self.menu()
            return
        
        try:
            amount = float(input("Enter amount to deposit: $"))
            
            if amount > 0:
                self.balance += amount
                print(f"‚úì ${amount:.2f} deposited successfully!")
                print(f"New balance: ${self.balance:.2f}\n")
            else:
                print("‚ùå Invalid amount! Amount must be positive.\n")
        except ValueError:
            print("‚ùå Invalid input! Please enter a numeric value.\n")
        
        self.menu()
    
    def withdraw(self):
        """
        Withdraw money from the account after PIN verification.
        Validates sufficient balance and positive amount.
        """
        print("\n--- Withdraw Money ---")
        
        # Verify PIN before allowing withdrawal
        if not self._verify_pin():
            self.menu()
            return
        
        try:
            amount = float(input("Enter amount to withdraw: $"))
            
            if amount > 0 and amount <= self.balance:
                self.balance -= amount
                print(f"‚úì ${amount:.2f} withdrawn successfully!")
                print(f"Remaining balance: ${self.balance:.2f}\n")
            elif amount > self.balance:
                print(f"‚ùå Insufficient balance! Available: ${self.balance:.2f}\n")
            else:
                print("‚ùå Invalid amount! Amount must be positive.\n")
        except ValueError:
            print("‚ùå Invalid input! Please enter a numeric value.\n")
        
        self.menu()
    
    def check_balance(self):
        """
        Display current account balance after PIN verification.
        """
        print("\n--- Check Balance ---")
        
        # Verify PIN before showing balance
        if not self._verify_pin():
            self.menu()
            return
        
        print(f"üí∞ Your current balance is: ${self.balance:.2f}\n")
        self.menu()
    
    def _verify_pin(self):
        """
        Private method to verify user's PIN.
        
        Returns:
            bool: True if PIN is correct, False otherwise
        """
        # Check if PIN has been created
        if not self.pin:
            print("‚ùå Please create a PIN first!\n")
            return False
        
        entered_pin = input("Enter your PIN: ")
        
        if entered_pin == self.pin:
            return True
        else:
            print("‚ùå Incorrect PIN!\n")
            return False
    
    def _exit_system(self):
        """
        Private method to exit the ATM system gracefully.
        """
        print("\n" + "=" * 50)
        print("Thank you for using our ATM!".center(50))
        print("Have a great day!".center(50))
        print("=" * 50 + "\n")
        exit()


def main():
    """
    Main function to run the ATM system.
    """
    # Create and run ATM instance
    atm = ATM()


# Entry point of the program
if __name__ == "__main__":
    main()
